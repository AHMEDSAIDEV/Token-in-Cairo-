<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Nodes ðŸš§ - The Starknet Book</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="title-page.html">The Starknet Book</a></li><li class="chapter-item expanded affix "><a href="ch00-00-introduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="ch01-00-getting-started.html"><strong aria-hidden="true">1.</strong> Getting Started</a></li><li class="chapter-item expanded "><a href="ch02-00-starknet-tooling.html"><strong aria-hidden="true">2.</strong> Tooling</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch02-01-basic-installation.html"><strong aria-hidden="true">2.1.</strong> Basic Installation</a></li><li class="chapter-item expanded "><a href="ch02-02-compile-deploy-interact.html"><strong aria-hidden="true">2.2.</strong> Compile, Deploy, Interact</a></li><li class="chapter-item expanded "><a href="ch02-03-scarb.html"><strong aria-hidden="true">2.3.</strong> Scarb: The Package Manager</a></li><li class="chapter-item expanded "><a href="ch02-04-starkli.html"><strong aria-hidden="true">2.4.</strong> Starkli: A CLI interface ðŸš§</a></li><li class="chapter-item expanded "><a href="ch02-05-katana.html"><strong aria-hidden="true">2.5.</strong> Katana: A Local Node</a></li><li class="chapter-item expanded "><a href="ch02-06-starknet-devnet.html"><strong aria-hidden="true">2.6.</strong> Starknet Devnet ðŸš§</a></li><li class="chapter-item expanded "><a href="ch02-07-starknet-js.html"><strong aria-hidden="true">2.7.</strong> Starknet-js: Javascript SDK</a></li><li class="chapter-item expanded "><a href="ch02-08-starknet-react.html"><strong aria-hidden="true">2.8.</strong> Starknet-React: React Integration</a></li><li class="chapter-item expanded "><a href="ch02-09-starknet-py.html"><strong aria-hidden="true">2.9.</strong> Starknet-py: Python SDK ðŸš§</a></li><li class="chapter-item expanded "><a href="ch02-10-starknet-rs.html"><strong aria-hidden="true">2.10.</strong> Starknet-rs: Rust SDK ðŸš§</a></li><li class="chapter-item expanded "><a href="ch02-11-foundry-cast.html"><strong aria-hidden="true">2.11.</strong> Foundry Cast: Interacting with Starknet ðŸš§</a></li><li class="chapter-item expanded "><a href="ch02-12-foundry-forge.html"><strong aria-hidden="true">2.12.</strong> Foundry Forge: Testing ðŸš§</a></li></ol></li><li class="chapter-item expanded "><a href="ch03-00-architecture.html"><strong aria-hidden="true">3.</strong> Architecture</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch03-01-transactions.html"><strong aria-hidden="true">3.1.</strong> Transactions</a></li><li class="chapter-item expanded "><a href="ch03-02-sequencers.html"><strong aria-hidden="true">3.2.</strong> Sequencers</a></li><li class="chapter-item expanded "><a href="ch03-03-provers.html"><strong aria-hidden="true">3.3.</strong> Provers ðŸš§</a></li><li class="chapter-item expanded "><a href="ch03-04-nodes.html" class="active"><strong aria-hidden="true">3.4.</strong> Nodes ðŸš§</a></li><li class="chapter-item expanded "><a href="ch03-05-layer-3.html"><strong aria-hidden="true">3.5.</strong> Layer 3 and App Chains ðŸš§  </a></li><li class="chapter-item expanded "><a href="ch03-06-solidity-verifier.html"><strong aria-hidden="true">3.6.</strong> Solidity Verifier ðŸš§</a></li><li class="chapter-item expanded "><a href="ch03-07-decentralization.html"><strong aria-hidden="true">3.7.</strong> Decentralization ðŸš§</a></li></ol></li><li class="chapter-item expanded "><a href="ch04-00-account-abstraction.html"><strong aria-hidden="true">4.</strong> Account Abstraction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch04-01-accounts.html"><strong aria-hidden="true">4.1.</strong> Accounts</a></li><li class="chapter-item expanded "><a href="ch04-02-hello-account.html"><strong aria-hidden="true">4.2.</strong> Hello, Account! ðŸš§</a></li><li class="chapter-item expanded "><a href="ch04-03-standard-account.html"><strong aria-hidden="true">4.3.</strong> Standard AccounT ðŸš§</a></li><li class="chapter-item expanded "><a href="ch04-04-examples.html"><strong aria-hidden="true">4.4.</strong> Examples</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch04-04-01-multicaller.html"><strong aria-hidden="true">4.4.1.</strong> Multicaller ðŸš§</a></li><li class="chapter-item expanded "><a href="ch04-04-02-multisig.html"><strong aria-hidden="true">4.4.2.</strong> Multisig ðŸš§</a></li><li class="chapter-item expanded "><a href="ch04-04-03-auto-payments.html"><strong aria-hidden="true">4.4.3.</strong> Auto-Payments ðŸš§</a></li><li class="chapter-item expanded "><a href="ch04-04-04-alternative-signature-schemes.html"><strong aria-hidden="true">4.4.4.</strong> Alternative Signature Schemes ðŸš§</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="ch05-00-starks.html"><strong aria-hidden="true">5.</strong> STARKs ðŸš§</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch05-01-basics.html"><strong aria-hidden="true">5.1.</strong> Basics ðŸš§</a></li><li class="chapter-item expanded "><a href="ch05-02-math-primer.html"><strong aria-hidden="true">5.2.</strong> Math Primer ðŸš§</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch05-02-01-number-theory.html"><strong aria-hidden="true">5.2.1.</strong> Number Theory ðŸš§</a></li><li class="chapter-item expanded "><a href="ch05-02-02-geometry.html"><strong aria-hidden="true">5.2.2.</strong> Geometry ðŸš§</a></li><li class="chapter-item expanded "><a href="ch05-02-03-cryptographic-primitives.html"><strong aria-hidden="true">5.2.3.</strong> Cryptographic Primitives ðŸš§</a></li></ol></li><li class="chapter-item expanded "><a href="ch05-03-arithimization.html"><strong aria-hidden="true">5.3.</strong> Arithimization ðŸš§</a></li><li class="chapter-item expanded "><a href="ch05-04-low-degree-testing.html"><strong aria-hidden="true">5.4.</strong> Low Degree Testing ðŸš§</a></li><li class="chapter-item expanded "><a href="ch05-05-fri-protocol.html"><strong aria-hidden="true">5.5.</strong> FRI Protocol ðŸš§</a></li><li class="chapter-item expanded "><a href="ch05-06-efficient-starks.html"><strong aria-hidden="true">5.6.</strong> Efficient STARKs</a></li><li class="chapter-item expanded "><a href="ch05-07-starks-protocol-python.html"><strong aria-hidden="true">5.7.</strong> STARKs Protocol (Python) ðŸš§</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch05-07-01-trace-low-degree-extension-python.html"><strong aria-hidden="true">5.7.1.</strong> Trace/Low Degree Extension ðŸš§</a></li><li class="chapter-item expanded "><a href="ch05-07-02-constraints-python.html"><strong aria-hidden="true">5.7.2.</strong> Constraints ðŸš§</a></li><li class="chapter-item expanded "><a href="ch05-07-03-fri-commitments-python.html"><strong aria-hidden="true">5.7.3.</strong> FRI Commitments ðŸš§</a></li><li class="chapter-item expanded "><a href="ch05-07-04-query-phase-python.html"><strong aria-hidden="true">5.7.4.</strong> Query Phase ðŸš§</a></li></ol></li><li class="chapter-item expanded "><a href="ch05-08-starks-protocol-rust.html"><strong aria-hidden="true">5.8.</strong> STARKs Protocol (Rust) ðŸš§</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch05-08-01-trace-low-degree-extension-rust.html"><strong aria-hidden="true">5.8.1.</strong> Trace/Low Degree Extension ðŸš§</a></li><li class="chapter-item expanded "><a href="ch05-08-02-constraints-rust.html"><strong aria-hidden="true">5.8.2.</strong> Constraints ðŸš§</a></li><li class="chapter-item expanded "><a href="ch05-08-03-fri-commitments-rust.html"><strong aria-hidden="true">5.8.3.</strong> FRI Commitments ðŸš§</a></li><li class="chapter-item expanded "><a href="ch05-08-04-query-phase-rust.html"><strong aria-hidden="true">5.8.4.</strong> Query Phase ðŸš§</a></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Starknet Book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="nodes"><a class="header" href="#nodes">Nodes</a></h1>
<p>This chapter will guide you through setting up and running a Starknet
node, illustrating the layered tech stack concept, and explaining how to
operate these protocols locally. Starknet, as a Layer 2 Validity Rollup,
operates on top of Ethereum Layer 1, creating a protocol stack that each
addresses different functionalities, similar to the OSI model for
internet connections. This chapter is an edit of
<a href="https://medium.com/starknet-edu/the-starknet-stack-7b0d70a7e1d4">drspacemn</a>'s
blog.</p>
<p>CONTRIBUTE: This guide shows how to run a Starknet node locally with a
particular setup. You can contribute to this guide by adding more
options for hardware and software, as well as other ways to run a
Starknet nod (for example using
<a href="https://github.com/keep-starknet-strange/beerus">Beerus</a>). You can also
contribute by adding more information about the Starknet stack and the
different layers. Feel free to <a href="https://github.com/starknet-edu/starknetbook">open a
PR</a>.</p>
<h2 id="what-is-a-node-in-the-context-of-ethereum-and-blockchain"><a class="header" href="#what-is-a-node-in-the-context-of-ethereum-and-blockchain">What is a Node in the Context of Ethereum and Blockchain?</a></h2>
<p>In the context of Ethereum and blockchain, a node is an integral part of
the network that validates and relays transactions. Nodes download a
copy of the entire blockchain and are interconnected with other nodes to
maintain and update the blockchain state. There are different types of
nodes, such as full nodes, light nodes, and mining nodes, each having
different roles and responsibilities within the network.</p>
<h2 id="overview-of-starknet-technology"><a class="header" href="#overview-of-starknet-technology">Overview of Starknet Technology</a></h2>
<p>Starknet is a permissionless, zk-STARK-based Layer-2 network, aiming for
full decentralization. It enables developers to build scalable
decentralized applications (dApps) and utilizes Ethereumâ€™s Layer 1 for
proof verification and data availability. Key aspects of Starknet
include:</p>
<ul>
<li>
<p><strong>Cairo execution environment</strong>: Cairo, the execution environment of
Starknet, facilitates writing and execution of complex smart
contracts.</p>
</li>
<li>
<p><strong>Scalability</strong>: Starknet achieves scalability through zk-STARK
proofs, minimizing the data needed to be posted on-chain.</p>
</li>
<li>
<p><strong>Node network</strong>: The Starknet network comprises nodes that
synchronize and process transactions, contributing to the networkâ€™s
overall security and decentralization.</p>
</li>
</ul>
<h2 id="starknet-stack"><a class="header" href="#starknet-stack">Starknet Stack</a></h2>
<p>The Starknet stack can be divided into various layers, similar to OSI or
TCP/IP models. The most appropriate model depends on your understanding
and requirements. A simplified version of the modular blockchain stack
might look like this:</p>
<ul>
<li>
<p>Layer 1: Data Layer</p>
</li>
<li>
<p>Layer 2: Execution Layer</p>
</li>
<li>
<p>Layer 3: Application Layer</p>
</li>
<li>
<p>Layer 4: Transport Layer</p>
</li>
</ul>
<img alt="Modular blockchain layers" src="img/ch03-modular-blockcahain-layers.png" class="center" style="width: 50%;" />
<p><span class="caption">Modular blockchain layers</span></p>
<h2 id="setup"><a class="header" href="#setup">Setup</a></h2>
<p>There are various hardware specifications, including packaged options,
that will enable you to run an Ethereum node from home. The goal here is
to build the most cost-efficient Starknet stack possible (<a href="https://github.com/rocket-pool/docs.rocketpool.net/blob/main/src/guides/node/local/hardware.md">see here more
options</a>).</p>
<p><strong>Minimum Requirements:</strong></p>
<ul>
<li>
<p>CPU: 2+ cores</p>
</li>
<li>
<p>RAM: 4 GB</p>
</li>
<li>
<p>Disk: 600 GB</p>
</li>
<li>
<p>Connection Speed: 8 mbps/sec</p>
</li>
</ul>
<p><strong>Recommended Specifications:</strong></p>
<ul>
<li>
<p>CPU: 4+ cores</p>
</li>
<li>
<p>RAM: 16 GB+</p>
</li>
<li>
<p>Disk 2 TB</p>
</li>
<li>
<p>Connection Speed: 25+ mbps/sec</p>
</li>
</ul>
<p><strong>You can refer to these links for the hardware:</strong></p>
<ul>
<li>
<p><a href="https://a.co/d/iAWpTzQ">CPU</a> â€” $193</p>
</li>
<li>
<p><a href="https://a.co/d/cTUk9Kd">Board</a> (can attempt w/ Raspberry Pi) â€” $110</p>
</li>
<li>
<p><a href="https://a.co/d/0US61Y5">Disk</a> â€” $100</p>
</li>
<li>
<p><a href="https://a.co/d/br867sk">RAM</a> â€” $60</p>
</li>
<li>
<p><a href="https://a.co/d/2k3Gn40">PSU</a> â€” $40</p>
</li>
<li>
<p><a href="https://a.co/d/apCBGwF">Case</a> â€” $50</p>
</li>
</ul>
<p>Total â€” $553</p>
<p>Recommended operating system and software: Ubuntu LTS,
<a href="https://docs.docker.com/engine/install/ubuntu">Docker</a>, and <a href="https://docs.docker.com/compose/install/linux">Docker
Compose</a>. Ensure you have
the necessary tools installed with:</p>
<pre><code>sudo apt install -y jq curl net-tools
</code></pre>
<h2 id="layer-1-data-layer"><a class="header" href="#layer-1-data-layer">Layer 1: Data Layer</a></h2>
<p>The bottom-most layer of the stack is the data layer. Here, Starknetâ€™s
L2 leverages Ethereumâ€™s L1 for proof verification and data availability.
Starknet utilizes Ethereum as its L1, so the first step is setting up an
Ethereum Full Node. As this is the data layer, the hardware bottleneck
is usually the disk storage. Itâ€™s crucial to have a high capacity I/O
SSD over an HDD because Ethereum Nodes require both an Execution Client
and a Consensus Client for communication.</p>
<p>Ethereum provides several options for Execution and Consensus clients.
Execution clients include Geth, Erigon, Besu (used here), Nethermind,
and Akula. Consensus clients include Prysm, Lighthouse (used here),
Lodestar, Nimbus, and Teku.</p>
<p>Your Besu/Lighthouse node will take approximately 600 GB of disk space.
Navigate to a partition on your machine with sufficient capacity and run
the following commands:</p>
<pre><code>git clone https://github.com/starknet-edu/starknet-stack.git
cd starknet-stack
docker-compose -f dc-l1.yaml up -d
</code></pre>
<p>This will begin the fairly long process of spinning up our Consensus
Client, Execution Client, and syncing them to the current state of the
Goerli Testnet. If you would like to see the logs from either process
you can run:</p>
<pre><code># tail besu logs
docker container logs -f $(docker ps | grep besu | awk '{print $1}')

# tail lighthouse logs
docker container logs -f $(docker ps | grep lighthouse | awk '{print $1}')
</code></pre>
<p>Lets make sure that everything that should be listening is listening:</p>
<pre><code># should see all ports in command output

# besu ports
sudo netstat -lpnut | grep -E '30303|8551|8545'

# lighthouse ports
sudo netstat -lpnut | grep -E '5054|9000'
</code></pre>
<p>Weâ€™ve used docker to abstract a lot of the nuance of running an Eth L1
node, but the important things to note are how the two processes EL/CL
point to each other and communicate via JSON-RPC:</p>
<pre><code>services:
  lighthouse:
      image: sigp/lighthouse:latest
      container_name: lighthouse
      volumes:
        - ./l1_consensus/data:/root/.lighthouse
        - ./secret:/root/secret
      network_mode: &quot;host&quot;
      command:
        - lighthouse
        - beacon
        - --network=goerli
        - --metrics
        - --checkpoint-sync-url=https://goerli.beaconstate.info
        - --execution-endpoint=http://127.0.0.1:8551
        - --execution-jwt=/root/secret/jwt.hex

  besu:
    image: hyperledger/besu:latest
    container_name: besu
    volumes:
      - ./l1_execution/data:/var/lib/besu
      - ./secret:/var/lib/besu/secret
    network_mode: &quot;host&quot;
    command:
      - --network=goerli
      - --rpc-http-enabled=true
      - --data-path=/var/lib/besu
      - --data-storage-format=BONSAI
      - --sync-mode=X_SNAP
      - --engine-rpc-enabled=true
      - --engine-jwt-enabled=true
      - --engine-jwt-secret=/var/lib/besu/secret/jwt.hex
</code></pre>
<p>Once this is done, your Ethereum node should be up and running, and it
will start syncing with the Ethereum network.</p>
<h2 id="layer-2-execution-layer"><a class="header" href="#layer-2-execution-layer">Layer 2: Execution Layer</a></h2>
<p>The next layer in our Starknet stack is the Execution Layer. This layer
is responsible for running the Cairo VM, which executes Starknet smart
contracts. The Cairo VM is a deterministic virtual machine that allows
developers to write complex smart contracts in the Cairo language.
Starknet uses a similar <a href="https://github.com/starkware-libs/starknet-specs">JSON-RPC
spec</a> as
<a href="https://ethereum.org/en/developers/docs/apis/json-rpc">Ethereum</a> in
order to interact with the execution layer.</p>
<p>In order to stay current with the propagation of the Starknet blockchain
we need a client similar to Besu that we are using for L1. The efforts
to provide full nodes for the Starknet ecosystem are:
<a href="https://github.com/eqlabs/pathfinder">Pathfinder</a> (used here),
<a href="https://github.com/starkware-libs/papyrus">Papyrus</a>, and
<a href="https://github.com/NethermindEth/juno">Juno</a>. However, different
implementations are still in development and not yet ready for
production.</p>
<p>Check that your L1 has completed its sync:</p>
<pre><code># check goerli etherscan to make sure you have the latest block https://goerli.etherscan.io

curl --location --request POST 'http://localhost:8545' \
--header 'Content-Type: application/json' \
--data-raw '{
    &quot;jsonrpc&quot;:&quot;2.0&quot;,
    &quot;method&quot;:&quot;eth_blockNumber&quot;,
    &quot;params&quot;:[],
    &quot;id&quot;:83
}'

# Convert the result, which is hex (remove 0x) to decimal. Example:
echo $(( 16#246918 ))
</code></pre>
<p>Start your L2 Execution Client and note that we are syncing Starknetâ€™s
state from our LOCAL ETH L1 NODE!</p>
<p>PATHFINDER_ETHEREUM_API_URL=http://127.0.0.1:8545</p>
<pre><code># from starknet-stack project root
docker-compose -f dc-l2.yaml up -d
</code></pre>
<p>To follow the sync:</p>
<pre><code>docker container logs -f $(docker ps | grep pathfinder | awk '{print $1}')
</code></pre>
<p>Starknet <a href="https://testnet.starkscan.co">Testnet_1</a> currently comprises
800,000+ blocks so this will take some time (days) to sync fully. To
check L2 sync:</p>
<pre><code># compare `current_block_num` with `highest_block_num`

curl --location --request POST 'http://localhost:9545' \
--header 'Content-Type: application/json' \
--data-raw '{
 &quot;jsonrpc&quot;:&quot;2.0&quot;,
 &quot;method&quot;:&quot;starknet_syncing&quot;,
 &quot;params&quot;:[],
 &quot;id&quot;:1
}'
</code></pre>
<p>To check data sizes:</p>
<pre><code>sudo du -sh ./* | sort -rh
</code></pre>
<h2 id="layer-3-application-layer"><a class="header" href="#layer-3-application-layer">Layer 3: Application Layer</a></h2>
<p>We see the same need for data refinement as we did in the OSI model. On
L1 packets come over the wire in a raw stream of bytes and are then
processed and filtered by higher-level protocols. When designing a
decentralized application Bob will need to be cognizant of interactions
with his contract on chain, but doesnâ€™t need to be aware of all the
information occurring on Starknet.</p>
<p>This is the role of an indexer. To process and filter useful information
for an application. Information that an application MUST be opinionated
about and the underlying layer MUST NOT be opinionated about.</p>
<p>Indexers provide applications flexibility as they can be written in any
programming language and have any data layout that suits the
application.</p>
<p>To start our toy
<a href="https://github.com/starknet-edu/starknet-stack/blob/main/indexer/indexer.sh">indexer</a>
run:</p>
<pre><code>./indexer/indexer.sh
</code></pre>
<p>Again notice that we donâ€™t need to leave our local setup for these
interactions (<a href="http://localhost:9545">http://localhost:9545</a>).</p>
<h2 id="layer-4-transport-layer"><a class="header" href="#layer-4-transport-layer">Layer 4: Transport Layer</a></h2>
<p>The transport layer comes into play when the application has parsed and
indexed critical information, often leading to some state change based
on this information. This is where the application communicates the
desired state change to the Layer 2 sequencer to get that change into a
block. This is achieved using the same full-node/RPC spec
implementation, in our case, Pathfinder.</p>
<p>When working with our local Starknet stack, invoking a transaction
locally might look like this:</p>
<pre><code>curl --location --request POST 'http://localhost:9545' \
--header 'Content-Type: application/json' \
--data-raw '{
    &quot;jsonrpc&quot;: &quot;2.0&quot;,
    &quot;method&quot;: &quot;starknet_addInvokeTransaction&quot;,
    &quot;params&quot;: {
        &quot;invoke_transaction&quot;: {
            &quot;type&quot;: &quot;INVOKE&quot;,
            &quot;max_fee&quot;: &quot;0x4f388496839&quot;,
            &quot;version&quot;: &quot;0x0&quot;,
            &quot;signature&quot;: [
                &quot;0x7dd3a55d94a0de6f3d6c104d7e6c88ec719a82f4e2bbc12587c8c187584d3d5&quot;,
                &quot;0x71456dded17015d1234779889d78f3e7c763ddcfd2662b19e7843c7542614f8&quot;
            ],
            &quot;contract_address&quot;: &quot;0x23371b227eaecd8e8920cd429d2cd0f3fee6abaacca08d3ab82a7cdd&quot;,
            &quot;calldata&quot;: [
                &quot;0x1&quot;,
                &quot;0x677bb1cdc050e8d63855e8743ab6e09179138def390676cc03c484daf112ba1&quot;,
                &quot;0x362398bec32bc0ebb411203221a35a0301193a96f317ebe5e40be9f60d15320&quot;,
                &quot;0x0&quot;,
                &quot;0x1&quot;,
                &quot;0x1&quot;,
                &quot;0x2b&quot;,
                &quot;0x0&quot;
            ],
            &quot;entry_point_selector&quot;: &quot;0x15d40a3d6ca2ac30f4031e42be28da9b056fef9bb7357ac5e85627ee876e5ad&quot;
        }
    },
    &quot;id&quot;: 0
}'
</code></pre>
<p>However, this process involves setting up a local wallet and signing the
transaction. For simplicity, we will use a browser wallet and StarkScan.</p>
<p>Steps:</p>
<ol>
<li>
<p>Navigate to the contract on StarkScan and connect to your wallet.</p>
</li>
<li>
<p>Enter a new value and write the transaction:</p>
</li>
</ol>
<img alt="Starkscan block explorer" src="img/ch03-starkscan-block-explorer.png" class="center" style="width: 50%;" />
<p><span class="caption">Starkscan block explorer</span></p>
<p>Once the transaction is accepted on the Layer 2 execution layer, the
event data should come through our application layer indexer.</p>
<p>Example Indexer Output:</p>
<pre><code>Pulled Block #: 638703
Found transaction: 0x2053ae75adfb4a28bf3a01009f36c38396c904012c5fc38419f4a7f3b7d75a5
Events to Index:
[
  {
    &quot;from_address&quot;: &quot;0x806778f9b06746fffd6ca567e0cfea9b3515432d9ba39928201d18c8dc9fdf&quot;,
    &quot;keys&quot;: [
      &quot;0x1fee98324df9b8703ae8de6de3068b8a8dce40c18752c3b550c933d6ac06765&quot;
    ],
    &quot;data&quot;: [
      &quot;0xa&quot;
    ]
  },
  {
    &quot;from_address&quot;: &quot;0x126dd900b82c7fc95e8851f9c64d0600992e82657388a48d3c466553d4d9246&quot;,
    &quot;keys&quot;: [
      &quot;0x5ad857f66a5b55f1301ff1ed7e098ac6d4433148f0b72ebc4a2945ab85ad53&quot;
    ],
    &quot;data&quot;: [
      &quot;0x2053ae75adfb4a28bf3a01009f36c38396c904012c5fc38419f4a7f3b7d75a5&quot;,
      &quot;0x0&quot;
    ]
  },
  {
    &quot;from_address&quot;: &quot;0x49d36570d4e46f48e99674bd3fcc84644ddd6b96f7c741b1562b82f9e004dc7&quot;,
    &quot;keys&quot;: [
      &quot;0x99cd8bde557814842a3121e8ddfd433a539b8c9f14bf31ebf108d12e6196e9&quot;
    ],
    &quot;data&quot;: [
      &quot;0x126dd900b82c7fc95e8851f9c64d0600992e82657388a48d3c466553d4d9246&quot;,
      &quot;0x46a89ae102987331d369645031b49c27738ed096f2789c24449966da4c6de6b&quot;,
      &quot;0x17c1e31c270&quot;,
      &quot;0x0&quot;
    ]
  }
]
</code></pre>
<p>Once the transaction is accepted on Layer 1, we can query the Starknet
Core Contracts from our Layer 1 node to see the storage keys that have
been updated on our data layer!</p>
<p>You have successfully navigated through the entire Starknet stack, from
setting up your node, through executing and monitoring a transaction, to
inspecting its effects on the data layer. This journey has equipped you
with the understanding and the skills to interact with Starknet on a
deeper level.</p>
<h2 id="conclusion-understanding-the-modular-nature-of-starknet"><a class="header" href="#conclusion-understanding-the-modular-nature-of-starknet">Conclusion: Understanding the Modular Nature of Starknet</a></h2>
<p>Conceptual models, such as the ones used in this guide, are incredibly
useful in helping us understand complex systems. They can be refactored,
reformed, and nested to provide a clear and comprehensive view of how a
platform like Starknet operates. For instance, the OSI Model, a
foundational model for understanding network interactions, underpins our
modular stack.</p>
<p>A key concept to grasp is <em>Fractal Scaling.</em> This concept allows us to
extend our model to include additional layers beyond Layer 2, such as
Layer 3. In this extended model, the entire stack recurs above our
existing stack, as shown in the following diagram:</p>
<img alt="Fractal scaling in a modular blockchain environment" src="img/ch03-fractal-scaling.png" class="center" style="width: 50%;" />
<p><span class="caption">Fractal scaling in a modular blockchain environment</span></p>
<p>Just as Layer 2 compresses its transaction throughput into a proof and
state change that is written to Layer 1, we can apply the same
compression principle at Layer 3, proving and writing to Layer 2. This
not only gives us more control over the protocol rules but also allows
us to achieve higher compression ratios, enhancing the scalability of
our applications.</p>
<p>In essence, Starknetâ€™s modular and layered design, combined with the
power of Fractal Scaling, offers a robust and scalable framework for
building decentralized applications. Understanding this structure is
fundamental to effectively leveraging Starknetâ€™s capabilities and
contributing to its ecosystem.</p>
<p>This concludes our journey into running a Starknet node and traversing
its layered architecture. We hope that you now feel equipped to explore,
experiment with, and innovate within the Starknet ecosystem.</p>
<p>The Book is a community-driven effort created for the community.</p>
<ul>
<li>
<p>If youâ€™ve learned something, or not, please take a moment to provide
feedback through <a href="https://a.sprig.com/WTRtdlh2VUlja09lfnNpZDo4MTQyYTlmMy03NzdkLTQ0NDEtOTBiZC01ZjAyNDU0ZDgxMzU=">this 3-question
survey</a>.</p>
</li>
<li>
<p>If you discover any errors or have additional suggestions, donâ€™t
hesitate to open an <a href="https://github.com/starknet-edu/starknetbook/issues">issue on our GitHub
repository</a>.</p>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="ch03-03-provers.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="ch03-05-layer-3.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="ch03-03-provers.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="ch03-05-layer-3.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
